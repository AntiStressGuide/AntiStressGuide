<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8" />
<title>Stress Index</title>

<style>
  body {
    font-family: Arial, sans-serif;
    margin: 20px;
  }

  .bar-container {
    position: relative;
    width: 100%;
    height: 28px;
    background: #eee;
    border-radius: 6px;
    margin-top: 12px;
    overflow: hidden;
  }

  .bar-fill {
    height: 100%;
    width: 0%;
    background-color: #4CAF50;
    border-radius: 6px;
    transition: width 0.6s ease;
    z-index: 1;
  }

  .bar-text {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    color: black !important;
    font-weight: bold;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 5;        /* TEXT LIEGT OBEN */
    pointer-events: none;
  }

  #results {
    display: none;
    margin-top: 20px;
  }
</style>

</head>
<body>

<h2>Stress-Index Berechnung</h2>

<form id="clientForm">

  <!-- Beispielhafte Felder -->
  <label>Alter:</label>
  <input name="age" type="number" required><br><br>

  <label>Geschlecht:</label>
  <select name="gender">
    <option value="Male">Male</option>
    <option value="Female">Female</option>
  </select><br><br>

  <button type="submit">Berechnen</button>
</form>


<div id="results">
  <h3>Ihr Stress-Index</h3>

  <div class="bar-container">
    <div id="bar" class="bar-fill"></div>
    <div id="barText" class="bar-text"></div>
  </div>

  <br>
  <button id="newFormBtn">Neue Eingabe</button>
</div>


<script>
const form = document.getElementById("clientForm");

form.addEventListener("submit", (e) => {
  e.preventDefault();

  // Beispielhafte Variablen -------------------------------------------------
  const totalScore = 37;     // â† Dein JS berechnet das bereits
  const nutritionScore = 2;
  const phys = "150-300";
  const alcohol = 1;
  const drugs = 0;
  const stressAnswers = [1,2,3,2,3];
  const medicalList = ["None"];
  const responseID = "ASG-" + Date.now();
  // ------------------------------------------------------------------------

  // ðŸ“Œ 1) JS sammelt Kundendaten aus deinem Formular
  const clientData = {
    age: form.age.value,
    gender: form.gender.value,
    medical_conditions: medicalList,
    nutrition: nutritionScore,
    physical_activity: phys,
    habits: {
      alcohol,
      tobacco: 1,
      drugs,
      gambling: 2
    },
    stress_answers: stressAnswers,
    response_id: responseID
  };

  // ðŸ“Œ 2) Payload inklusive berechnetem Index
  const payload = {
    client_data: clientData,
    enhanced_stress_index: parseFloat(totalScore)
  };

  // ðŸ“Œ 3) POST direkt an deine Edge Function
  fetch("https://deine-edge-function-url.com/session", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(payload)
  })
  .then(r => r.json())
  .then(data => console.log("Session gespeichert:", data))
  .catch(err => console.error("POST-Error:", err));


  // --------- Anzeige des Balkens ---------------------------------------
  const bar = document.getElementById("bar");
  const barText = document.getElementById("barText");

  const percent = Math.min(100, Math.max(0, totalScore));

  bar.style.width = percent + "%";
  barText.textContent = percent + " %";

  form.style.display = "none";
  document.getElementById("results").style.display = "block";
});


// Reset
document.getElementById("newFormBtn").addEventListener("click", () => {
  form.reset();
  form.style.display = "block";
  document.getElementById("results").style.display = "none";
});
</script>

</body>
</html>
