<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Enhanced Stress Index (WHO-Based)</title>

<link rel="icon" type="image/png" href="Logo AntiStressGuide.png">
<link rel="shortcut icon" type="image/x-icon" href="Logo AntiStressGuide.ico">
<link rel="apple-touch-icon" sizes="180x180" href="Logo AntiStressGuide.png">

<style>
body { 
  font-family: Roboto, Arial, sans-serif; 
  background:#eaf5e8; 
  margin:0; 
  padding:0; 
  line-height:1.6; 
}
.container { 
  max-width:800px; 
  margin:30px auto; 
  background:#fff; 
  padding:30px; 
  border-radius:10px; 
  box-shadow:0 2px 6px rgba(0,0,0,0.1); 
}
.header { 
  display:flex; 
  align-items:center; 
  justify-content:space-between; 
  margin-bottom:20px; 
  background:#f7fff8; 
  padding:10px 20px; 
  border-radius:10px 10px 0 0; 
}
.header img.logo { height:50px; width:auto; }
.header nav a { margin-left:15px; text-decoration:underline; color:#007bff; font-weight:bold; }
.header nav a:hover { color:#27623e; }

h1,h2 { text-align:center; color:#2E5D3D; }

.question { margin:15px 0; padding:15px; border-radius:8px; }
.question:nth-child(odd){ background:#e0f2e9; }
.question:nth-child(even){ background:#f7fff8; }

label { display:block; margin:5px 0; font-size:18px; }
input[type="range"] { width:100%; margin-top:5px; }
.range-labels { display:flex; justify-content:space-between; font-size:14px; color:#555; margin-top:5px; }
input[type="checkbox"], input[type="radio"] { margin-right:10px; transform:scale(1.2); }
select, input[type=email] { width:100%; padding:12px; margin-top:10px; border-radius:30px; border:1px solid #ccc; font-size:18px; }
button { margin-top:10px; padding:12px 25px; color:#fff; background:#2E5D3D; border:none; border-radius:5px; cursor:pointer; font-size:16px; }
button:hover{ background:#27623e; }

.submit-container { display:flex; justify-content:space-between; gap:10px; flex-wrap:wrap; }
.submit-container button { flex:1; text-align:center; }

#errorMessage { color:red; text-align:center; margin-top:10px; display:none; }

#results { display:none; margin-top:20px; text-align:center; padding:20px; background:#e0f2e9; border-radius:10px; }

/* Container f√ºr die Balken (Hintergrund) */
.bar-container {  
  width: 100%; 
  background: #d9f0e0;  /* Farbe der leeren Balken */
  border-radius: 10px; 
  margin: 10px 0; 
  height: 28px; 
  position: relative; 
  overflow: hidden; 
}

/* Gef√ºllter Balken */
.bar { 
  height: 100%;                 /* Balkenh√∂he passt sich dem Container an */
  border-radius: 10px;          /* abgerundete Enden */
  line-height: 28px;            /* vertikale Zentrierung Text */
  color: #fff;                  /* Textfarbe */
  font-weight: bold;            
  text-align: center;           
  white-space: nowrap;          
  overflow: hidden;             
  text-overflow: ellipsis;      
  background: linear-gradient(90deg, #2E5D3D, #6fbf73); /* Farbverlauf, optional */
  transition: width 0.5s ease, background 0.5s ease; /* sanfte Animation */
}


footer { 
  text-align:center; 
  padding:20px; 
  background:#f7fff8; 
  border-radius:0 0 10px 10px;
  margin-top:30px;
  font-size:14px;
  color:#2E5D3D;
}

@media (max-width: 600px){ 
  .header { flex-direction:column; align-items:center; } 
  .header nav { margin-top:10px; } 
}

@media (max-width: 480px){
  .bar-container { height:auto; padding:2px 0; }
  .bar { 
    width:100% !important; 
    text-align:center; 
    padding-left:0; 
    padding-right:0;
    color:#000; 
    background:#d9f0e0; 
    border-radius:10px; 
    font-size:14px; 
    line-height:1.2em; 
    display:flex; 
    justify-content:center;
    align-items:center;
  }
}
</style>
</head>
<body>

<div class="container">
  <div class="header">
    <img src="Logo AntiStressGuide.png" alt="AntiStressGuide Logo" class="logo">
    <nav>
      <a href="index.html">Home</a>
      <a href="Affirmations.html">Affirmations</a>
    </nav>
  </div>

  <h1>Enhanced Stress Index (WHO-Based)</h1>

  <form id="assessmentForm">

    <!-- Demographics -->
    <h2>Demographics</h2>
    <div class="question">
      <label>Age:</label>
      <select name="age" required>
        <option value="" disabled selected>Select age</option>
        <option value="18-30">18‚Äì30</option>
        <option value="31-50">31‚Äì50</option>
        <option value="51-70">51‚Äì70</option>
        <option value=">70">>70</option>
      </select>
    </div>

    <div class="question">
      <label>Gender:</label>
      <select name="gender" required>
        <option value="" disabled selected>Select gender</option>
        <option value="Male">Male</option>
        <option value="Female">Female</option>
        <option value="Other">Other</option>
      </select>
    </div>

    <!-- Medical Conditions -->
    <h2>Medical Conditions</h2>
    <div class="question">
      <label>Do you have any chronic diseases, medical conditions, or recent surgeries?</label>
      <label><input type="checkbox" name="medical" value="None"> None</label>
      <label><input type="checkbox" name="medical" value="Cardiovascular Disease"> Cardiovascular Disease</label>
      <label><input type="checkbox" name="medical" value="Mental Health Condition"> Mental Health Condition</label>
      <label><input type="checkbox" name="medical" value="Recent Surgery"> Recent Surgery</label>
      <label><input type="checkbox" name="medical" value="Other"> Other</label>
    </div>

    <!-- Nutrition -->
    <h2>Nutrition</h2>
    <div class="question">
      <label>Overall diet quality</label>
      <label><input type="radio" name="nutrition" value="0" required> Very healthy diet ‚Äî Sugar &lt;5%, Salt &lt;3 g/day, Saturated fat &lt;5%</label>
      <label><input type="radio" name="nutrition" value="1"> Healthy diet ‚Äî Sugar 5‚Äì7%, Salt 3‚Äì5 g, Saturated fat 5‚Äì7%</label>
      <label><input type="radio" name="nutrition" value="2"> Average diet ‚Äî Sugar 5‚Äì10%, Salt 5‚Äì7 g, Saturated fat 7‚Äì10%</label>
      <label><input type="radio" name="nutrition" value="3"> Unhealthy diet ‚Äî Sugar 10‚Äì15%, Salt 7‚Äì10 g, Saturated fat 10‚Äì15%</label>
      <label><input type="radio" name="nutrition" value="4"> Very unhealthy diet ‚Äî Sugar &gt;15%, Salt &gt;10 g, Saturated fat &gt;15%</label>
    </div>

    <!-- Physical Activity -->
    <h2>Physical Activity</h2>
    <div class="question">
      <label>Weekly physical activity level:</label>
      <label><input type="radio" name="physical" value="Little or no activity" required>&lt;150 min/week, no strength training</label>
      <label><input type="radio" name="physical" value="150‚Äì300 min/week, 0‚Äì1 strength">150‚Äì300 min/week, 0‚Äì1 strength</label>
      <label><input type="radio" name="physical" value="150‚Äì300 min/week, 2+ strength">150‚Äì300 min/week, 2+ strength</label>
      <label><input type="radio" name="physical" value=">300 min/week, 2+ strength">&gt;300 min/week, 2+ strength</label>
      <label><input type="radio" name="physical" value="Vigorous 75‚Äì150+ min/week">Vigorous 75‚Äì150+ min/week</label>
    </div>

    <!-- Harmful Habits -->
    <h2>Harmful Habits</h2>
    <div class="question">
      <label>Alcohol consumption (per week)</label>
      <label><input type="radio" name="alcohol" value="0" required> None (0 drinks/week)</label>
      <label><input type="radio" name="alcohol" value="1"> Low risk (Women: 1‚Äì7, Men: 1‚Äì14/week)</label>
      <label><input type="radio" name="alcohol" value="2"> Moderate (Women: 8‚Äì14, Men: 15‚Äì28/week)</label>
      <label><input type="radio" name="alcohol" value="3"> High (Women: 15‚Äì21, Men: 29‚Äì42/week)</label>
      <label><input type="radio" name="alcohol" value="4"> Very high (Women: &gt;21, Men: &gt;42/week)</label>
    </div>

    <div class="question">
      <label>Tobacco use</label>
      <label><input type="radio" name="tobacco" value="0" required> None</label>
      <label><input type="radio" name="tobacco" value="1"> Low (&lt;5 cigarettes/day)</label>
      <label><input type="radio" name="tobacco" value="2"> Moderate (5‚Äì19/day)</label>
      <label><input type="radio" name="tobacco" value="3"> High (20/day)</label>
      <label><input type="radio" name="tobacco" value="4"> Very high (&ge;30/day)</label>
    </div>

    <div class="question">
      <label>Drug use</label>
      <label><input type="radio" name="drugs" value="0" required> None</label>
      <label><input type="radio" name="drugs" value="1"> Low (occasional use)</label>
      <label><input type="radio" name="drugs" value="2"> Moderate (regular use, risk present)</label>
      <label><input type="radio" name="drugs" value="3"> High (dependence / health risk)</label>
      <label><input type="radio" name="drugs" value="4"> Very high (severe dependence)</label>
    </div>

    <div class="question">
      <label>Gambling</label>
      <label><input type="radio" name="gambling" value="0" required> None</label>
      <label><input type="radio" name="gambling" value="1"> Low (occasional, minimal issues)</label>
      <label><input type="radio" name="gambling" value="2"> Moderate (regular, some issues)</label>
      <label><input type="radio" name="gambling" value="3"> High (frequent, significant issues)</label>
      <label><input type="radio" name="gambling" value="4"> Very high (pathological)</label>
    </div>

    <!-- Stress Questions -->
    <h2>Stress (0‚Äì4 Likert)</h2>
    <div id="stressContainer"></div>

    <div class="submit-container">
      <button type="button" id="submitIndex"><b>Submit for Index Value</b></button>
      <button type="button" id="submitSessions"><b>Submit for Stress Management Sessions</b></button>
    </div>
    <div id="errorMessage">‚ö†Ô∏è Please answer all required questions before submitting.</div>
  </form>

  <!-- Results -->
  <div id="results">
    <p id="responseID"></p>
    <p id="totalPoints"></p>
    <p id="categoryColor"></p>
    <div id="breakdown"></div>
    <div id="barChart"></div>
    <button id="newFormBtn" class="action">Fill Out Again</button>
  </div>

  <!-- Footer -->
  <footer>
    <p>¬© 2025 AntiStressGuide | <a href="Privacy.html">Privacy Policy</a> | <a href="Contact.html">Contact</a></p>
  </footer>
</div>

<script>
// ---------- CONFIG ----------
const likertLabels = ["Never","Rarely","Sometimes","Often","Very Often"];
const stressQuestions = [
  "In the past month, I felt that things were generally going my way.",
  "During the last month, I felt confident about handling personal problems.",
  "Over the past month, I felt physically and mentally healthy enough to meet daily demands.",
  "In the past month, I was satisfied with my overall well-being and quality of life.",
  "During the last month, I felt energetic and capable of handling both work and personal responsibilities.",
  "Over the past month, I could take breaks and recover adequately during and between workdays.",
  "In the last month, support from colleagues helped me cope with stress.",
  "During the past month, my work schedule allowed me to maintain a healthy work-life balance.",
  "Over the last month, my workload prevented me from completing important personal tasks.",
  "In the past month, I had sufficient control over how I completed my work tasks."
];

// ---------- Utility Functions ----------
function avg(arr) {
  const nums = arr.map(Number).filter(n => !isNaN(n));
  return nums.length ? nums.reduce((a,b) => a+b,0)/nums.length : 0;
}

function generateSequentialID() {
  const now = new Date();
  const yearMonth = `${now.getFullYear()}${String(now.getMonth()+1).padStart(2,'0')}`;
  const key = `internalID_${yearMonth}`;
  let n = parseInt(localStorage.getItem(key)||"0",10);
  n += 1;
  localStorage.setItem(key,n);
  return `ASG${yearMonth}${String(n).padStart(4,'0')}`;
}

// ---------- DOM Ready ----------
document.addEventListener('DOMContentLoaded', () => {
  const stressContainer = document.getElementById('stressContainer');

  // Stressfragen erzeugen
  stressQuestions.forEach((q, i) => {
    const div = document.createElement('div');
    div.className = 'question';
    div.innerHTML = `
      <label>${i+1}. ${q}</label>
      <input type="range" class="slider" min="0" max="4" value="2" name="q${i}" required>
      <div class="range-labels">${likertLabels.map(l => `<span>${l}</span>`).join('')}</div>
    `;
    stressContainer.appendChild(div);
  });

  const form = document.getElementById('assessmentForm');

  // Submit-Events
  document.getElementById('submitIndex').addEventListener('click', () => {
    if (!form.checkValidity()) {
      document.getElementById('errorMessage').style.display = 'block';
      return;
    }
    document.getElementById('errorMessage').style.display = 'none';
    submitIndexValue();
  });

  document.getElementById('submitSessions').addEventListener('click', () => {
    if (!form.checkValidity()) {
      document.getElementById('errorMessage').style.display = 'block';
      return;
    }
    document.getElementById('errorMessage').style.display = 'none';
    submitStressSessions();
  });

  // Reset-Formular
  document.getElementById('newFormBtn').addEventListener('click', ()=> {
    form.reset();
    document.getElementById('results').style.display='none';
    form.style.display='block';
  });
});

// ---------- Submit Functions ----------
function submitIndexValue() {
  const form = document.getElementById('assessmentForm');
  const responseID = generateSequentialID();

  // Stress
  const stressAnswers = stressQuestions.map((q,i) => parseInt(form.querySelector(`input[name="q${i}"]`).value));
  const stressScore = avg(stressAnswers);

  // Habits
  const habitsValues = ["alcohol","tobacco","drugs","gambling"].map(name => parseInt(form.querySelector(`input[name="${name}"]:checked`).value));
  const habitsScore = avg(habitsValues);

  // Physical
  const phys = form.querySelector('input[name="physical"]:checked')?.value;
  let physicalRaw = 0;
  switch(phys){
    case "Little or no activity": physicalRaw=0; break;
    case "150‚Äì300 min/week, 0‚Äì1 strength": physicalRaw=1; break;
    case "150‚Äì300 min/week, 2+ strength": physicalRaw=2; break;
    case ">300 min/week, 2+ strength": physicalRaw=3; break;
    case "Vigorous 75‚Äì150+ min/week": physicalRaw=4; break;
  }
  const physicalScore = 4 - physicalRaw;

  // Nutrition
  const nutritionScore = parseInt(form.querySelector('input[name="nutrition"]:checked').value);

  // Medical
  const medicalList = Array.from(form.querySelectorAll('input[name="medical"]:checked')).map(c=>c.value).filter(v=>v!=="None");
  const medicalScore = Math.min(4, medicalList.length);

  // Total
  const totalScore = ((stressScore + habitsScore + medicalScore + nutritionScore + physicalScore)/5).toFixed(2);

  let category="", color="";
  if(totalScore<1){category="Excellent / Low Risk"; color="üü¢";}
  else if(totalScore<2){category="Mild Risk"; color="üü°";}
  else if(totalScore<3){category="Elevated Risk"; color="üü†";}
  else{category="High / Very High Risk"; color="üî¥";}

  form.style.display='none';
  const results = document.getElementById('results');
  results.style.display='block';
  document.getElementById('responseID').textContent=`Response ID: ${responseID}`;
  document.getElementById('totalPoints').textContent=`Total Score: ${totalScore}`;
  document.getElementById('categoryColor').textContent=`Category: ${category} ${color}`;
  document.getElementById('breakdown').innerHTML=`<b>Breakdown:</b> Stress:${stressScore.toFixed(2)}, Habits:${habitsScore.toFixed(2)}, Nutrition:${nutritionScore}, Physical:${physicalScore}, Medical:${medicalScore}`;

  // Bar chart
  const barChart = document.getElementById('barChart');
  const components = [
    {label:"Stress",score:stressScore/4},
    {label:"Habits",score:habitsScore/4},
    {label:"Nutrition",score:nutritionScore/4},
    {label:"Physical",score:physicalScore/4},
    {label:"Medical",score:medicalScore/4}
  ];

  barChart.innerHTML="";

  components.forEach(c => {
    const container = document.createElement('div');
    container.className='bar-container';

    const bar = document.createElement('div');
    bar.className='bar';
    bar.style.width = `${c.score*100}%`;
    bar.textContent = `${c.label} (${Math.round(c.score*4)})`;

    // Farbe je nach Score
    if(c.score <= 0.25) bar.style.background = '#2ecc71';      // Gr√ºn
    else if(c.score <= 0.5) bar.style.background = '#f1c40f';  // Gelb
    else if(c.score <= 0.75) bar.style.background = '#e67e22'; // Orange
    else bar.style.background = '#e74c3c';                     // Rot

    container.appendChild(bar);
    barChart.appendChild(container);
  });
}

function submitStressSessions() {
  alert("Stress sessions submitted! (Hier kann die Edge-Function integriert werden)");
}



// ---------- Reset Form ----------
document.getElementById('newFormBtn').addEventListener('click', ()=>{
  form.reset();
  document.getElementById('results').style.display='none';
  form.style.display='block';
});
</script>

</body>
</html>
