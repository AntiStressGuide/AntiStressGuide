<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Enhanced Stress Index (WHO-Based)</title>
<style>
body { font-family: Roboto, Arial, sans-serif; background:#eaf5e8; margin:0; padding:0; }
.container { max-width:700px; margin:30px auto; background:#fff; padding:30px; border-radius:10px; }
h1, h2 { color:#2E5D3D; text-align:center; }
.question { margin:15px 0; padding:15px; border-radius:8px; }
.question:nth-child(odd) { background:#e0f2e9; }
.question:nth-child(even) { background:#f7fff8; }
label { display:block; margin:5px 0; }
input[type="range"] { width:100%; margin-top:5px; }
.range-labels { display:flex; justify-content:space-between; font-size:14px; color:#555; margin-top:5px; }
input[type="checkbox"], input[type="radio"] { margin-right:5px; }
select, input[type=email] { width:100%; padding:8px; margin-top:5px; border-radius:5px; border:1px solid #ccc; }
button { margin-top:10px; padding:12px 25px; color:#fff; background:#2E5D3D; border:none; border-radius:5px; cursor:pointer; font-size:16px; }
button:hover { background:#27623e; }

/* Ergebnisbox */
#results { display:none; margin-top:20px; padding:20px; border-radius:10px; background:#d4efd5; color:#004d00; font-weight:bold; text-align:center; }
#categoryColor { margin-top:10px; padding:15px; border-radius:8px; background:#e0ffe0; color:#004d00; font-size:18px; font-weight:bold; }
#newFormBtn { margin-top:15px; background:#004d00; color:#fff; border:none; border-radius:8px; padding:12px 25px; cursor:pointer; font-size:16px; }
#newFormBtn:hover { background:#002a00; }
</style>
</head>
<body>

<div class="container">
<h1>Enhanced Stress Index (WHO-Based)</h1>

<form id="assessmentForm">
  <!-- Hier alle Fragen wie Age, Gender, Health Conditions usw. ... -->
  <div id="questions"></div>

  <div class="question">
    <label>Email (optional)</label>
    <input type="email" name="email" placeholder="you@example.com">
  </div>

  <button type="submit">Submit</button>
</form>

<!-- Ergebnis -->
<div id="results">
  <div id="responseID"></div>
  <div id="totalPoints"></div>
  <div id="categoryColor"></div>
  <button id="newFormBtn">Fill Again</button>
</div>

<script>
// --- Web-App URL ---
const WEBAPP_URL = "https://script.google.com/macros/s/AKfycbwcdawgMthaJdFh1l_1kqvctRpqRVPmhUkimJTLGuc2fnwmxoeHzMSaXVs12sPPXM0/exec";

// Likert-Fragen
const likertLabels = ["Never","Rarely","Sometimes","Often","Very Often"];
const stressQuestions = [
  "In the past month, I felt that things were generally going my way.",
  "During the last month, I felt confident about handling personal problems.",
  "Over the past month, I felt physically and mentally healthy enough to meet daily demands.",
  "In the past month, I was satisfied with my overall well-being and quality of life.",
  "During the last month, I felt energetic and capable of handling both work and personal responsibilities.",
  "Over the past month, I could take breaks and recover adequately during and between workdays.",
  "In the last month, support from colleagues helped me cope with stress.",
  "During the past month, my work schedule allowed me to maintain a healthy work-life balance.",
  "Over the last month, my workload prevented me from completing important personal tasks.",
  "In the past month, I had sufficient control over how I completed my work tasks."
];
const questionsDiv = document.getElementById('questions');
stressQuestions.forEach((q,i)=>{
  const div=document.createElement('div');
  div.className='question';
  div.innerHTML=`<label>${i+1}. ${q}</label>
  <input type="range" min="0" max="4" value="2" name="q${i}" required>
  <div class="range-labels">${likertLabels.map(l=>`<span>${l}</span>`).join('')}</div>`;
  questionsDiv.appendChild(div);
});

// Sequenzielle Response ID
function generateSequentialID() {
  const now=new Date();
  const yearMonth=`${now.getFullYear()}${String(now.getMonth()+1).padStart(2,'0')}`;
  const storageKey=`internalID_${yearMonth}`;
  let currentNumber=parseInt(localStorage.getItem(storageKey)||"0",10);
  currentNumber+=1;
  localStorage.setItem(storageKey,currentNumber);
  return `ASG${yearMonth}${String(currentNumber).padStart(4,'0')}`;
}

// --- Web-App senden ---
async function sendToWebApp(formData){
  try {
    const resp = await fetch(WEBAPP_URL, {
      method: "POST",
      mode: "cors",
      headers: {"Content-Type": "application/json"},
      body: JSON.stringify(formData)
    });
    const result = await resp.json();
    console.log("Web-App Response:", result);
  } catch(err){
    console.error("Fehler beim Senden:", err);
  }
}

// Form Submit
const form=document.getElementById('assessmentForm');
form.addEventListener('submit', e=>{
  e.preventDefault();
  const responseID = generateSequentialID();

  // Stresspunkte berechnen
  let stressPoints=0;
  stressQuestions.forEach((q,i)=>{
    stressPoints+=parseInt(form.querySelector(`input[name="q${i}"]`).value);
  });

  // Physische AktivitÃ¤t
  let physicalPoints=0;
  const phys=form.querySelector('input[name="physical"]:checked')?.value;
  switch(phys){
    case "Little or no activity": physicalPoints=0; break;
    case "150â€“300 min/week, 0â€“1 strength": physicalPoints=1; break;
    case "150â€“300 min/week, 2+ strength": physicalPoints=2; break;
    case ">300 min/week, 2+ strength": physicalPoints=3; break;
    case "Vigorous 75â€“150+ min/week": physicalPoints=4; break;
  }

  // Schlechte Faktoren
  let badPoints=0;
  if(form.age.value==="31-50") badPoints+=1;
  if(form.age.value==="51-70") badPoints+=2;
  if(form.age.value==">70") badPoints+=3;
  form.querySelectorAll('input[name="chronic"]:checked').forEach(c=>{
    if(c.value!=="None") badPoints+=2;
  });
  ["alcohol","tobacco","drugs","gambling"].forEach(name=>{
    const val=form.querySelector(`input[name="${name}"]:checked`)?.value;
    if(val && val!=="None") badPoints+=1;
  });

  const totalPoints = Math.max(0, Math.min(63, stressPoints + badPoints - physicalPoints));

  // Kategorie & Farbpunkt
  let category="", color="";
  if(totalPoints<=12){ category="Sehr gut / niedriges Risiko"; color="ðŸŸ¢"; }
  else if(totalPoints<=25){ category="Gut / mildes Risiko"; color="ðŸŸ¢"; }
  else if(totalPoints<=38){ category="MÃ¤ÃŸig / mittleres Risiko"; color="ðŸŸ¡"; }
  else if(totalPoints<=51){ category="ErhÃ¶ht / auffÃ¤lliges Risiko"; color="ðŸŸ "; }
  else{ category="Hoch / sehr hohes Risiko"; color="ðŸ”´"; }

  // Ergebnis anzeigen
  form.style.display='none';
  const resultsDiv=document.getElementById('results');
  resultsDiv.style.display='block';
  document.getElementById('responseID').textContent=`Response ID: ${responseID}`;
  document.getElementById('totalPoints').textContent=`Gesamtpunkte: ${totalPoints}`;
  document.getElementById('categoryColor').textContent=`Kategorie: ${category} ${color}`;

  // --- Daten an Web-App senden ---
  const formData = {
    responseId: responseID,
    age: form.age.value,
    gender: form.gender.value,
    chronic: Array.from(form.querySelectorAll('input[name="chronic"]:checked')).map(c=>c.value),
    physical: phys,
    alcohol: form.querySelector('input[name="alcohol"]:checked')?.value,
    tobacco: form.querySelector('input[name="tobacco"]:checked')?.value,
    drugs: form.querySelector('input[name="drugs"]:checked')?.value,
    gambling: form.querySelector('input[name="gambling"]:checked')?.value,
    stress: stressQuestions.map((q,i)=>parseInt(form.querySelector(`input[name="q${i}"]`).value)),
    email: form.email.value,
    totalPoints: totalPoints,
    category: category,
    color: color
  };
  sendToWebApp(formData);
});

// Fill Again
document.getElementById('newFormBtn').addEventListener('click', ()=>{
  form.reset();
  form.style.display='block';
  document.getElementById('results').style.display='none';
});
</script>
</body>
</html>


