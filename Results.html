<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Enhanced Stress Index (WHO-Based)</title>
<style>
body { font-family: Roboto, Arial, sans-serif; background:#eaf5e8; margin:0; padding:0; }
.container { max-width:700px; margin:30px auto; background:#fff; padding:30px; border-radius:10px; }
h1, h2 { color:#2E5D3D; text-align:center; }
.question { margin:15px 0; padding:15px; border-radius:8px; }
.question:nth-child(odd) { background:#e0f2e9; }
.question:nth-child(even) { background:#f7fff8; }
label { display:block; margin:5px 0; }
input[type="range"] { width:100%; margin-top:5px; }
.range-labels { display:flex; justify-content:space-between; font-size:14px; color:#555; margin-top:5px; }
input[type="checkbox"], input[type="radio"] { margin-right:5px; }
select, input[type=email] { width:100%; padding:8px; margin-top:5px; border-radius:5px; border:1px solid #ccc; }
button { margin-top:10px; padding:12px 25px; color:#fff; background:#2E5D3D; border:none; border-radius:5px; cursor:pointer; font-size:16px; }
button:hover { background:#27623e; }
nav { text-align:center; margin-bottom:20px; }
nav a { margin:0 10px; text-decoration:underline; color:#007bff; font-weight:bold; }
nav a:hover { color:#27623e; }
</style>
</head>
<body>

<div class="container">
<nav>
  <a href="index.html">Home</a>
  <a href="results.html">Assessment</a>
  <a href="recommendations.html">Recommendations</a>
</nav>

<h1>Enhanced Stress Index (WHO-Based)</h1>

<form id="assessmentForm">

  <!-- Demographics, Health, Habits wie vorher... -->

  <h2>Stress & Well-Being (0–4 Likert Scale)</h2>
  <div id="questions"></div>

  <!-- Email -->
  <div class="question">
    <label>Email (optional)</label>
    <input type="email" name="email" placeholder="you@example.com">
  </div>

  <button type="submit">Submit</button>
</form>

<script>
// --- Likert-Fragen dynamisch erstellen ---
const stressQuestions = [
  "I feel tense or 'on edge'.",
  "I have trouble relaxing.",
  "I feel unhappy or depressed.",
  "I feel overwhelmed by my responsibilities.",
  "I have trouble sleeping due to stress.",
  "I feel energetic and positive.",  // inversed scoring if nötig
  "I feel able to cope with daily challenges."
];

const questionsContainer = document.getElementById("questions");

stressQuestions.forEach((q, i) => {
  const div = document.createElement("div");
  div.className = "question";
  div.innerHTML = `<label>${q}</label>
    <label><input type="radio" name="q${i+1}" value="0" required> 0</label>
    <label><input type="radio" name="q${i+1}" value="1"> 1</label>
    <label><input type="radio" name="q${i+1}" value="2"> 2</label>
    <label><input type="radio" name="q${i+1}" value="3"> 3</label>
    <label><input type="radio" name="q${i+1}" value="4"> 4</label>`;
  questionsContainer.appendChild(div);
});

// --- Generiert eine Response ID ---
function generateSequentialID() {
  return 'RESP_' + Date.now();
}

// --- Form Submit ---
const form = document.getElementById('assessmentForm');
form.addEventListener('submit', async (e) => {
  e.preventDefault();

  const responseID = generateSequentialID();
  const formData = new FormData(form);
  const jsonData = {};

  formData.forEach((value, key) => {
    // Checkboxen als Array speichern
    if(jsonData[key]) {
      if (Array.isArray(jsonData[key])) jsonData[key].push(value);
      else jsonData[key] = [jsonData[key], value];
    } else {
      jsonData[key] = value;
    }
  });

  jsonData.responseID = responseID;

  try {
    const res = await fetch("http://localhost:3000/submit", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(jsonData)
    });

    const text = await res.text();
    alert("Formular gesendet! Antwort: " + text);
    form.reset();
  } catch(err) {
    console.error("Fehler beim Senden:", err);
    alert("Fehler beim Senden. Siehe Konsole.");
  }
});
</script>

</body>
</html>
